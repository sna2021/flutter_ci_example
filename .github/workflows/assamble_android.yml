name: Assamble android
on:
  workflow_call:
    inputs:
      build_type:
        description: 'apk or appbundle'
        required: true
        type: string
        default: apk
      build_flavor:
        description: 'prod or dev'
        required: true
        type: string
        default: prod
      flutter_version:
        required: true
#    secrets:
#      android_secrets:
#        required: true
jobs:
  build:
    name: Build prod ${{ inputs.build_type }}
    runs-on: [ self-hosted ]
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-java@v1
        with:
          java-version: '12.x'
      - uses: subosito/flutter-action@v1
        with:
          flutter-version: ${{ secrets.flutter_version }}
          channel: 'stable'
      - name: Check flow
        run: sh ./.github/scripts/flutter_check_flow.sh
#      - name: Decrypt Android keys
#        run: sh ./.github/scripts/android/decrypt_android_keys.sh
#        env:
#          ANDROID_KEYS_SECRET_PASSPHRASE: ${{ secrets.android_secrets }}

      - name: Build ${{ inputs.build_type }}
        run: sh ./.github/scripts/android/build_android.sh
        env:
          BUILD_FLAVOR: ${{ inputs.build_flavor }}
          ANDROID_BUILD_TYPE: ${{ inputs.build_type }}
